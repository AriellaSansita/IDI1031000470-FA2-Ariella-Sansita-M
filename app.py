import streamlit as st
import google.generativeai as genai
import os

# ЁЯФР Configure API
genai.configure(api_key=os.getenv("GEMINI_API_KEY"))
model = genai.GenerativeModel("gemini-1.5-flash")

# --- ЁЯЪА Complete Instant Load Translation Dictionary ---
translations = {
    "English": {
        "title": "ЁЯМ▒ Smart Farming Assistant",
        "loc": "Enter location",
        "stage": "Crop stage",
        "stages": ["Planting", "Growing", "Harvesting"],
        "const": "Constraints (e.g. Organic)",
        "ask": "Your question",
        "btn": "Get Advice",
        "header": "Advice",
        "error": "Please enter a question."
    },
    "Bengali": {
        "title": "ЁЯМ▒ рж╕рзНржорж╛рж░рзНржЯ ржлрж╛рж░рзНржорж┐ржВ рж╕рж╣ржХрж╛рж░рзА",
        "loc": "ржЖржкржирж╛рж░ ржЕржмрж╕рзНржерж╛ржи рж▓рж┐ржЦрзБржи",
        "stage": "ржлрж╕рж▓рзЗрж░ ржкрж░рзНржпрж╛ржпрж╝",
        "stages": ["рж░рзЛржкржг", "ржмрзГржжрзНржзрж┐", "ржХрж╛ржЯрж╛"],
        "const": "рж╕рзАржорж╛ржмржжрзНржзрждрж╛ (ржпрзЗржоржи: ржЬрзИржм)",
        "ask": "ржЖржкржирж╛рж░ ржкрзНрж░рж╢рзНржи ржЬрж┐ржЬрзНржЮрж╛рж╕рж╛ ржХрж░рзБржи",
        "btn": "ржкрж░рж╛ржорж░рзНрж╢ ржирж┐ржи",
        "header": "ржХрзГрж╖рж┐ ржкрж░рж╛ржорж░рзНрж╢",
        "error": "ржжржпрж╝рж╛ ржХрж░рзЗ ржПржХржЯрж┐ ржкрзНрж░рж╢рзНржи рж▓рж┐ржЦрзБржиред"
    },
    "Marathi": {
        "title": "ЁЯМ▒ рд╕реНрдорд╛рд░реНрдЯ рд╢реЗрддреА рд╕рд╣рд╛рдпреНрдпрдХ",
        "loc": "рддреБрдордЪреЗ рдард┐рдХрд╛рдг рдЯрд╛рдХрд╛",
        "stage": "рдкрд┐рдХрд╛рдЪреА рдЕрд╡рд╕реНрдерд╛",
        "stages": ["рд▓рд╛рдЧрд╡рдб", "рд╡рд╛рдв", "рдХрд╛рдврдгреА"],
        "const": "рдорд░реНрдпрд╛рджрд╛ (рдЙрджрд╛. рд╕реЗрдВрджреНрд░рд┐рдп)",
        "ask": "рддреБрдордЪрд╛ рдкреНрд░рд╢реНрди рд╡рд┐рдЪрд╛рд░рд╛",
        "btn": "рд╕рд▓реНрд▓рд╛ рдорд┐рд│рд╡рд╛",
        "header": "рд╢реЗрддреА рд╕рд▓реНрд▓рд╛",
        "error": "рдХреГрдкрдпрд╛ рдкреНрд░рд╢реНрди рдкреНрд░рд╡рд┐рд╖реНрдЯ рдХрд░рд╛."
    },
    "Kannada": {
        "title": "ЁЯМ▒ р▓╕р│Нр▓ор▓╛р▓░р│Нр▓Яр│Н р▓Хр│Гр▓╖р▓┐ р▓╕р▓╣р▓╛р▓пр▓Х",
        "loc": "р▓ир▓┐р▓ор│Нр▓о р▓╕р│Нр▓ер▓│р▓╡р▓ир│Нр▓ир│Б р▓ир▓ор│Вр▓жр▓┐р▓╕р▓┐",
        "stage": "р▓мр│Жр▓│р│Ж р▓╣р▓Вр▓д",
        "stages": ["р▓мр▓┐р▓др│Нр▓др▓ир│Ж", "р▓мр│Жр▓│р▓╡р▓гр▓┐р▓Чр│Ж", "р▓Хр▓Яр▓╛р▓╡р│Б"],
        "const": "р▓ор▓┐р▓др▓┐р▓Чр▓│р│Б (р▓Йр▓жр▓╛: р▓╕р▓╛р▓╡р▓пр▓╡)",
        "ask": "р▓ир▓┐р▓ор│Нр▓о р▓кр│Нр▓░р▓╢р│Нр▓ир│Жр▓пр▓ир│Нр▓ир│Б р▓Хр│Зр▓│р▓┐",
        "btn": "р▓╕р▓▓р▓╣р│Ж р▓кр▓бр│Жр▓пр▓┐р▓░р▓┐",
        "header": "р▓Хр│Гр▓╖р▓┐ р▓╕р▓▓р▓╣р│Ж",
        "error": "р▓жр▓пр▓╡р▓┐р▓Яр│Нр▓Яр│Б р▓кр│Нр▓░р▓╢р│Нр▓ир│Жр▓пр▓ир│Нр▓ир│Б р▓ир▓ор│Вр▓жр▓┐р▓╕р▓┐."
    },
    "Malayalam": {
        "title": "ЁЯМ▒ р┤╕р╡Нр┤ор┤╛р╡╝р┤Яр╡Нр┤Яр╡Н р┤лр┤╛р┤ор┤┐р┤Вр┤Чр╡Н р┤Ер┤╕р┤┐р┤╕р╡Нр┤▒р╡Нр┤▒р┤ир╡Нр┤▒р╡Н",
        "loc": "р┤ир┤┐р┤Щр╡Нр┤Щр┤│р╡Бр┤Яр╡Ж р┤╕р╡Нр┤ер┤▓р┤В р┤ир╡╜р┤Хр╡Бр┤Х",
        "stage": "р┤╡р┤┐р┤│ р┤Шр┤Яр╡Нр┤Яр┤В",
        "stages": ["р┤ир┤Яр╡Ар╡╜", "р┤╡р┤│р╡╝р┤Ър╡Нр┤Ъ", "р┤╡р┤┐р┤│р┤╡р╡Жр┤Яр╡Бр┤кр╡Нр┤кр╡Н"],
        "const": "р┤кр┤░р┤┐р┤ор┤┐р┤др┤┐р┤Хр╡╛ (р┤Йр┤жр┤╛: р┤Ьр╡Ир┤╡р┤В)",
        "ask": "р┤ир┤┐р┤Щр╡Нр┤Щр┤│р╡Бр┤Яр╡Ж р┤Ър╡Лр┤жр╡Нр┤пр┤В р┤Ър╡Лр┤жр┤┐р┤Хр╡Нр┤Хр╡Бр┤Х",
        "btn": "р┤Йр┤кр┤жр╡Зр┤╢р┤В р┤др╡Зр┤Яр╡Бр┤Х",
        "header": "р┤Хр┤╛р╡╝р┤╖р┤┐р┤Х р┤Йр┤кр┤жр╡Зр┤╢р┤В",
        "error": "р┤жр┤пр┤╡р┤╛р┤пр┤┐ р┤Тр┤░р╡Б р┤Ър╡Лр┤жр╡Нр┤пр┤В р┤ир╡╜р┤Хр╡Бр┤Х."
    },
    "Gujarati": {
        "title": "ЁЯМ▒ рк╕рлНркорк╛рк░рлНркЯ рклрк╛рк░рлНркорк┐ркВркЧ рк╕рк╣рк╛ркпркХ",
        "loc": "ркдркорк╛рк░рлБркВ рк╕рлНркерк╛рки ркжрк╛ркЦрк▓ ркХрк░рлЛ",
        "stage": "рккрк╛ркХркирлЛ ркдркмркХрлНркХрлЛ",
        "stages": ["рк╡рк╛рк╡ркгрлА", "рк╡рк┐ркХрк╛рк╕", "рк▓ркгркгрлА"],
        "const": "ркорк░рлНркпрк╛ркжрк╛ркУ (ркжрк╛.ркд. ркЬрлИрк╡рк┐ркХ)",
        "ask": "ркдркорк╛рк░рлЛ рккрлНрк░рк╢рлНрки рккрлВркЫрлЛ",
        "btn": "рк╕рк▓рк╛рк╣ ркорлЗрк│рк╡рлЛ",
        "header": "ркЦрлЗркдрлАркирлА рк╕рк▓рк╛рк╣",
        "error": "ркХрлГрккрк╛ ркХрк░рлАркирлЗ рккрлНрк░рк╢рлНрки ркжрк╛ркЦрк▓ ркХрк░рлЛ."
    },
    "Punjabi": {
        "title": "ЁЯМ▒ ри╕риори╛ри░риЯ риЦрйЗридрйА ри╕ри╣ри╛риЗриХ",
        "loc": "риЖрикригри╛ ри╕риери╛рии рижри░риЬ риХри░рйЛ",
        "stage": "рилри╕ри▓ рижри╛ рикрйЬри╛риЕ",
        "stages": ["римри┐риЬри╛риИ", "ри╡ри╛ризри╛", "риХриЯри╛риИ"],
        "const": "рикри╛римрй░рижрйАриЖриВ (риЬри┐ри╡рйЗриВ: риЬрйИри╡ри┐риХ)",
        "ask": "риЖрикригри╛ ри╕ри╡ри╛ри▓ рикрйБрй▒риЫрйЛ",
        "btn": "ри╕ри▓ри╛ри╣ ри▓риУ",
        "header": "риЦрйЗридрйА ри╕ри▓ри╛ри╣",
        "error": "риХри┐ри░рикри╛ риХри░риХрйЗ риЗрй▒риХ ри╕ри╡ри╛ри▓ рижри░риЬ риХри░рйЛред"
    },
    "Hindi": {
        "title": "ЁЯМ▒ рд╕реНрдорд╛рд░реНрдЯ рдЦреЗрддреА рд╕рд╣рд╛рдпрдХ",
        "loc": "рд╕реНрдерд╛рди рджрд░реНрдЬ рдХрд░реЗрдВ",
        "stage": "рдлрд╕рд▓ рдХрд╛ рдЪрд░рдг",
        "stages": ["рдмреБрд╡рд╛рдИ", "рдмрдврд╝рдд", "рдХрдЯрд╛рдИ"],
        "const": "рд╕реАрдорд╛рдПрдВ (рдЬреИрд╕реЗ: рдЬреИрд╡рд┐рдХ)",
        "ask": "рдЖрдкрдХрд╛ рдкреНрд░рд╢реНрди",
        "btn": "рд╕рд▓рд╛рд╣ рд▓реЗрдВ",
        "header": "рд╕реБрдЭрд╛рд╡",
        "error": "рдХреГрдкрдпрд╛ рдкреНрд░рд╢реНрди рджрд░реНрдЬ рдХрд░реЗрдВред"
    }
}

# --- ЁЯЫая╕П Logic ---
# Extracting the keys (languages) from our dictionary to populate the dropdown
available_languages = list(translations.keys())

selected_lang = st.sidebar.selectbox("ЁЯМР Choose Language", available_languages)

# Get the UI labels based on selection
ui = translations[selected_lang]

# --- ЁЯЦея╕П User Interface ---
st.title(ui["title"])

col1, col2 = st.columns(2)
with col1:
    location = st.text_input(ui["loc"])
with col2:
    crop_stage = st.selectbox(ui["stage"], ui["stages"])

constraints = st.text_input(ui["const"])
query = st.text_area(ui["ask"])

if st.button(ui["btn"]):
    if query.strip():
        # The prompt forces Gemini to respond in the selected language
        prompt = (
            f"Location: {location}, Stage: {crop_stage}, Constraints: {constraints}. "
            f"Question: {query}. Respond ONLY in {selected_lang} in 3-5 simple points."
        )
        
        with st.spinner("..."):
            response = model.generate_content(prompt)
            
        st.divider()
        st.subheader(ui["header"])
        st.write(response.text)
    else:
        st.warning(ui["error"])
