import streamlit as st
import google.generativeai as genai
import os

# ЁЯФР Configure API
genai.configure(api_key=os.getenv("GEMINI_API_KEY"))
model = genai.GenerativeModel("gemini-1.5-flash")

# --- ЁЯЪА Final Expanded Translation Dictionary ---
translations = {
    "English": {
        "title": "ЁЯМ▒ Smart Farming Assistant",
        "loc": "Enter location",
        "stage": "Crop stage",
        "stages": ["Planting", "Growing", "Harvesting"],
        "const": "Constraints (e.g. Organic)",
        "ask": "Your question",
        "btn": "Get Advice",
        "header": "Advice",
        "error": "Please enter a question."
    },
    "Telugu (р░др▒Жр░▓р▒Бр░Чр▒Б)": {
        "title": "ЁЯМ▒ р░╕р▒Нр░ор░╛р░░р▒Нр░Яр▒Н р░лр░╛р░░р▒Нр░ор░┐р░Вр░Чр▒Н р░Ер░╕р░┐р░╕р▒Нр░Яр▒Жр░Вр░Яр▒Н",
        "loc": "р░кр▒Нр░░р░╛р░Вр░др░╛р░ир▒Нр░ир░┐ р░ир░ор▒Лр░жр▒Б р░Ър▒Зр░пр░Вр░бр░┐",
        "stage": "р░кр░Вр░Я р░жр░╢",
        "stages": ["р░ир░╛р░Яр░бр░В", "р░кр▒Жр░░р▒Бр░Чр▒Бр░жр░▓", "р░Хр▒Лр░д"],
        "const": "р░кр░░р░┐р░ор░┐р░др▒Бр░▓р▒Б",
        "ask": "р░ор▒А р░кр▒Нр░░р░╢р▒Нр░и",
        "btn": "р░╕р░▓р░╣р░╛ р░кр▒Кр░Вр░жр░Вр░бр░┐",
        "header": "р░╕р░▓р░╣р░╛",
        "error": "р░жр░пр░Ър▒Зр░╕р░┐ р░Тр░Х р░кр▒Нр░░р░╢р▒Нр░ир░ир▒Б р░ир░ор▒Лр░жр▒Б р░Ър▒Зр░пр░Вр░бр░┐."
    },
    "Tamil (родрооро┐ро┤рпН)": {
        "title": "ЁЯМ▒ ро╕рпНрооро╛ро░рпНроЯрпН ро╡ро┐ро╡роЪро╛роп роЙродро╡ро┐ропро╛ро│ро░рпН",
        "loc": "роЗро░рпБрокрпНрокро┐роЯродрпНродрпИ роЙро│рпНро│ро┐роЯро╡рпБроорпН",
        "stage": "рокропро┐ро░рпН роиро┐ро▓рпИ",
        "stages": ["роироЯро╡рпБ", "ро╡ро│ро░рпНроЪрпНроЪро┐", "роЕро▒рпБро╡роЯрпИ"],
        "const": "роХроЯрпНроЯрпБрокрпНрокро╛роЯрпБроХро│рпН",
        "ask": "роЙроЩрпНроХро│рпН роХрпЗро│рпНро╡ро┐",
        "btn": "роЖро▓рпЛроЪройрпИ рокрпЖро▒рпБроЩрпНроХро│рпН",
        "header": "роЖро▓рпЛроЪройрпИ",
        "error": "родропро╡рпБроЪрпЖропрпНродрпБ роТро░рпБ роХрпЗро│рпНро╡ро┐ропрпИроЪрпН роЪрпЗро░рпНроХрпНроХро╡рпБроорпН."
    },
    "Urdu (╪з╪▒╪п┘И)": {
        "title": "ЁЯМ▒ ╪│┘Е╪з╪▒┘╣ ┘Б╪з╪▒┘Е┘Ж┌п ╪з╪│╪│┘╣┘Ж┘╣",
        "loc": "┘Е┘В╪з┘Е ╪п╪▒╪м ┌й╪▒█М┌║",
        "stage": "┘Б╪╡┘Д ┌й╪з ┘Е╪▒╪н┘Д█Б",
        "stages": ["┌й╪з╪┤╪к", "┘Ж╪┤┘И┘И┘Ж┘Е╪з", "┌й┘╣╪з╪ж█М"],
        "const": "┘╛╪з╪и┘Ж╪п█М╪з┌║",
        "ask": "╪з┘╛┘Ж╪з ╪│┘И╪з┘Д ┘╛┘И┌Ж┌╛█М┌║",
        "btn": "┘Е╪┤┘И╪▒█Б ╪н╪з╪╡┘Д ┌й╪▒█М┌║",
        "header": "┘Е╪┤┘И╪▒█Б",
        "error": "╪и╪▒╪з█Б ┌й╪▒┘Е ╪з█М┌й ╪│┘И╪з┘Д ╪п╪▒╪м ┌й╪▒█М┌║█Ф"
    },
    "Santali (с▒ес▒Яс▒▒с▒Ыс▒Яс▒▓с▒д)": {
        "title": "ЁЯМ▒ с▒ес▒вс▒Яс▒ис▒┤ с▒кс▒Яс▒е с▒Ьс▒Ъс▒▓с▒Ъс▒нс▒дс▒б",
        "loc": "с▒бс▒Яс▒нс▒Ьс▒Я с▒ис▒ос▒▒с▒Яс▒Ь с▒зс▒йс▒Ыс▒йс▒в",
        "stage": "с▒кс▒Яс▒е с▒ис▒ос▒▒с▒Яс▒Ь с▒Ъс▒ас▒Ыс▒Ъ",
        "stages": ["с▒ис▒Ъс▒жс▒Ъс▒н", "с▒жс▒Яс▒ис▒Яс▒Ь", "с▒дс▒и"],
        "const": "с▒╡с▒Яс▒лс▒╖с▒Я с▒ас▒Ъ",
        "ask": "с▒ас▒йс▒Юс▒дс▒нс▒Яс▒в",
        "btn": "с▒╡с▒йс▒лс▒╖с▒д с▒жс▒Яс▒Ыс▒Яс▒г",
        "header": "с▒кс▒Яс▒е с▒╡с▒йс▒лс▒╖с▒д",
        "error": "с▒лс▒Яс▒нс▒Я с▒ас▒Яс▒Ыс▒о с▒вс▒дс▒лс▒┤с▒Яс▒╣с▒Э с▒ас▒йс▒ас▒Юс▒д с▒Ъс▒Ю с▒вс▒о"
    },
    "Kashmiri (┌й┘▓╪┤┘П╪▒)": {
        "title": "ЁЯМ▒ ╪│┘Е╪з╪▒┘╣ ┌й┘▓╪┤╪к█М ┘Е╪п╪п┌п╪з╪▒",
        "loc": "╪м╪з╪ж█Т ╪п╪▒╪м ┌й┘Ф╪▒█М┘И",
        "stage": "┘Б╪╡┘Д█Б┘Х┌Ж ╪н╪з┘Д╪к",
        "stages": ["╪к╪о┘Е ╪▒█М╪▓█М", "╪и█Ж┌И ┌п┌Ш┌╛┘П┘Ж", "┘Д█Ж┘Ж┘П┘Ж"],
        "const": "╪▒┘П┌й╪з┘И┘╣",
        "ask": "┘╛┘Ж┘П┘Ж ╪│┘И╪з┘Д ┘╛┘П╪▒┌Ш┌╛█М┘И",
        "btn": "┘Е╪┤┘И╪▒┘Х █Б█М╪к┌╛█М┘И",
        "header": "┌й┘▓╪┤╪к█М ┘Е╪┤┘И╪▒┘Х",
        "error": "┘Е█Б╪▒█Б╪и┘▓┘Ж█М ┌й┘Ф╪▒╪к┌╛ ┌й┘Ф╪▒█М┘И ╪│┘И╪з┘Д ╪п╪▒╪м"
    },
    "Sindhi (╪│┘Ж┌М┘К)": {
        "title": "ЁЯМ▒ ╪│┘Е╪з╪▒┘╜ ┘Б╪з╪▒┘Е┘Ж┌п ┘Е╪п╪п┌п╪з╪▒",
        "loc": "╪м┌│┘З┘З ╪п╪з╪о┘Д ┌к╪▒┘К┘И",
        "stage": "┘Б╪╡┘Д ╪м┘И ┘Е╪▒╪н┘Д┘И",
        "stages": ["┘╛┘И┘И┌й┘К", "┘И╪з┌М ┘И┘К╪м┘З┘З", "┘Д┘И┌П╪з ┌й┌╗┌╗"],
        "const": "╪▒┌к╪з┘И┘╜┘И┘Ж",
        "ask": "╪│┘И╪з┘Д ┘╛┌З┘И",
        "btn": "╪╡┘Д╪з╪н ┘И┘║┘И",
        "header": "╪▓╪▒╪з╪╣╪к ╪м┘К ╪╡┘Д╪з╪н",
        "error": "┘Е┘З╪▒╪и╪з┘Ж┘К ┌к╪▒┘К ╪│┘И╪з┘Д ╪п╪з╪о┘Д ┌к╪▒┘К┘И"
    },
    "Konkani (рдХреЛрдВрдХрдгреА)": {
        "title": "ЁЯМ▒ рд╕реНрдорд╛рд░реНрдЯ рд╢реЗрддреА рд╕рд╣рд╛рдпреНрдпрдХ",
        "loc": "рд╕реБрд╡рд╛рдд рдмрд░рдпрд╛рдд",
        "stage": "рдкрд┐рдХрд╛рдЪреА рдЕрд╡рд╕реНрдерд╛",
        "stages": ["рд▓рд╛рд╡рдб", "рд╡рд╛рдв", "рдХрд╛рдврдгреА"],
        "const": "рдорд░реНрдпрд╛рджрд╛",
        "ask": "рддреБрдордЪреЛ рдкреНрд░рд╢реНрди рд╡рд┐рдЪрд╛рд░рд╛рдд",
        "btn": "рд╕рд▓реНрд▓реЛ рдШреЗрдпрд╛рдд",
        "header": "рд╢реЗрддреА рд╕рд▓реНрд▓реЛ",
        "error": "рдЙрдкрдХрд╛рд░ рдХрд░реВрди рдкреНрд░рд╢реНрди рд╡рд┐рдЪрд╛рд░рд╛рдд"
    },
    "Dogri (рдбреЛрдЧрд░реА)": {
        "title": "ЁЯМ▒ рд╕реНрдорд╛рд░реНрдЯ рдЦреЗрддреА рд╕рд╣рд╛рдпрдХ",
        "loc": "рдерд╛рд╣рдВ рджрд╕реНрд╕реЛ",
        "stage": "рдлрд╕рд▓ рджрд╛ рдЪрд░рдг",
        "stages": ["рдмрд┐рдЬрд╛рдИ", "рдмрдзрд╛рдИ", "рдХрдЯрд╛рдИ"],
        "const": "рд░реБрдХрд╛рд╡рдЯ",
        "ask": "рдЕрдкрдирд╛ рд╕реБрдЖрд▓ рдкреБрдЪреНрдЫреЛ",
        "btn": "рд╕рд▓рд╛рд╣ рд▓реИрдУ",
        "header": "рдЦреЗрддреА рд╕рд▓рд╛рд╣",
        "error": "рдорд╣рд░рдмрд╛рдиреА рдХрд░реА рд╕реБрдЖрд▓ рд▓рд┐рдЦреЛ"
    },
    "Odia (рмУрмбрм╝рм┐рмЖ)": {
        "title": "ЁЯМ▒ рм╕рнНрморм╛рм░рнНрмЯ рмХрнГрм╖рм┐ рм╕рм╣рм╛рнЯрмХ",
        "loc": "рм╕рнНрмерм╛рми",
        "stage": "рмкрм░рнНрмпрнНрнЯрм╛рнЯ",
        "stages": ["рммрнБрмгрм┐рммрм╛", "рммрмврм┐рммрм╛", "рмЕрморм│"],
        "const": "рмкрнНрм░рмдрм┐рммрмирнНрмзрмХ",
        "ask": "рмкрнНрм░рм╢рнНрми рмкрмЪрм╛рм░рмирнНрмдрнБ",
        "btn": "рмкрм░рм╛рморм░рнНрм╢",
        "header": "рм╕рнБрмЭрм╛рмм",
        "error": "рмкрнНрм░рм╢рнНрми рм▓рнЗрмЦрмирнНрмдрнБ"
    }
    # Note: Bengali, Hindi, Marathi, etc. from previous code should be kept here too.
}

# --- ЁЯЫая╕П Application Logic ---
available_languages = list(translations.keys())
selected_lang_full = st.sidebar.selectbox("ЁЯМР Select Language", available_languages)

ui = translations[selected_lang_full]

st.title(ui["title"])

col1, col2 = st.columns(2)
with col1:
    location = st.text_input(ui["loc"])
with col2:
    crop_stage = st.selectbox(ui["stage"], ui["stages"])

constraints = st.text_input(ui["const"])
query = st.text_area(ui["ask"])

if st.button(ui["btn"]):
    if query.strip():
        # IMPORTANT: Extracting just the name (e.g., "Tamil") for Gemini to understand
        clean_lang = selected_lang_full.split(" (")[0]
        
        prompt = (
            f"You are an expert farming consultant. "
            f"Location: {location}. Crop Stage: {crop_stage}. Constraints: {constraints}. "
            f"Farmer's Question: {query}. "
            f"Provide 3-5 clear, practical bullet points. "
            f"CRITICAL: Your entire response must be written ONLY in {clean_lang}."
        )
        
        with st.spinner("..."):
            response = model.generate_content(prompt)
            
        st.divider()
        st.subheader(ui["header"])
        st.write(response.text)
    else:
        st.error(ui["error"])
